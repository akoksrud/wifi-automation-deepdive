# 156. Post install configuration

### Create InfluxDB token

The first thing we will do after installing and starting our applications, is to create a Token for InfluxDB. We will need this token to access the database. It is not possible to create a specified token, we have to make InfluxDB create one for us. We will then insert this token into the .env file. The command is a concatenation of many Linux commands so for now you can just copy-paste and it will work.

{% code overflow="wrap" fullWidth="true" %}
```bash
grep -v "INFLUXDB_TOKEN" .env > temp && mv temp .env
echo "INFLUXDB_TOKEN=$(docker exec influxdb influxdb3 create token --admin | grep Token: | awk '{print $2}')" >> .env
source .env
```
{% endcode %}

### Create InfluxDB database

We will then create a database named "c9800-db" to store the metrics for our WLAN Controllers.

{% code overflow="wrap" fullWidth="true" %}
```bash
docker exec influxdb influxdb3 create database --token "${INFLUXDB_TOKEN}" "${INFLUXDB_DB}"
```
{% endcode %}

<div data-full-width="true"><figure><img src="../../.gitbook/assets/image (171).png" alt=""><figcaption></figcaption></figure></div>

### Restart the containers

After creating the token and the database, we need to restart everything to make sure we use our new token and database.

```bash
docker compose down
docker compose up -d
```

### Some explanation (optional)

By demand, here are a bit more explanation of what the commands actually do:

```bash
grep -v "INFLUXDB_TOKEN" .env > temp && mv temp .env
```

This first line use grep, with the inverse (-v) flag, so it will output all lines NOT containing the text "INFLUXDB\_TOKEN", from the file ".env".

It will output this into a new file named "temp"

Then it will move (rename) the file "temp" to ".env" which will overwrite the old .env file. Now without the line containing the text "INFLUXDB\_TOKEN", no matter if it was empty or a previous value.

{% code fullWidth="true" %}
```bash
echo "INFLUXDB_TOKEN=$(docker exec influxdb influxdb3 create token --admin | grep Token: | awk '{print $2}')" >> .env
```
{% endcode %}

The "outer" part of this command, will print (echo) the text "INFLUXDB\_TOKEN=\<some text>" and append ( >> ) it to the file ".env"

The "\<some text>" here is actually running a series of commands to create the text that will be inserted. You can run these commands separately to check their output.

The first part will create a new token, and print it on screen:

```bash
docker exec influxdb influxdb3 create token --admin
```

The next part is adding a "grep" to only return the line containing the text "Token:"

```bash
docker exec influxdb influxdb3 create token --admin | grep Token:
```

Then we add the "awk" command to only return the token itself

```bash
docker exec influxdb influxdb3 create token --admin | grep Token: | awk '{print $2}'
```

Lastly, we tell Linux to use the environment variables in the .env file, so we can use them in the next command, where we need the token to create a database:

{% code fullWidth="true" %}
```bash
source .env
docker exec influxdb influxdb3 create database --token "${INFLUXDB_TOKEN}" "${INFLUXDB_DB}"
```
{% endcode %}
